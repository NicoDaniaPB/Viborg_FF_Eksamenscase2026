# 4. Fit lineær regressionsmodel ------------------------------------------
stor_lm_model <- lm(
tilskuere ~ temp_dry + wind_speed + nedbør_seneste_7_timer +
ugedag + udehold + mål_hjemme + mål_ude + point_hjemmehold +
point_udehold + udehold_rang + sæson + runde + tidsperiode +
Er_helligdag + i_sommerferie + i_efterårsferie + i_vinterferie +
ferieperiode + total_income + total_expense + net_balance +
antal_transfers + d10_tilskuere + d7_tilskuere + d3_tilskuere +
udehold_navn + stadion + sponsor_stadion_navn + stadion_kapacitet,
data = train_data
)
summary(stor_lm_model)
# 5. Predict på testdata ---------------------------------------------------
tilskuere_hat <- predict(stor_lm_model, newdata = test_data)
# 6. Beregn MSE og RMSE, og R^2 på testdata---------------------------------
mse_stor_validation  <- mean((test_data$tilskuere - tilskuere_hat)^2)
rmse_stor_validation <- sqrt(mse_stor_validation)
ss_res <- sum((test_data$tilskuere - tilskuere_hat)^2)
ss_tot <- sum((test_data$tilskuere - mean(test_data$tilskuere))^2)
r2_test <- 1 - ss_res/ss_tot
mse_stor_validation
rmse_stor_validation
r2_test
vif(stor_lm_model)
car::vif(stor_lm_model)
tilskuere_hat
# 5. Predict på testdata ---------------------------------------------------
tilskuere_hat <- predict(stor_lm_model, newdata = test_data)
# 6. Beregn MSE og RMSE, og R^2 på testdata---------------------------------
mse_stor_validation  <- mean((test_data$tilskuere - tilskuere_hat)^2)
rmse_stor_validation <- sqrt(mse_stor_validation)
ss_res <- sum((test_data$tilskuere - tilskuere_hat)^2)
ss_tot <- sum((test_data$tilskuere - mean(test_data$tilskuere))^2)
r2_test <- 1 - ss_res/ss_tot
mse_stor_validation
rmse_stor_validation
r2_test
car::vif(stor_lm_model)
# Load nødvendige pakker
pacman::p_load("tidyverse", "forcats", "car")
# 1. Load data -------------------------------------------------------------
VFF_samlet_variabler <- readRDS("VFFdata/VFF_samlet_variabler.rds")
# Konverter relevante variabler til faktorer
VFF_samlet_variabler <- VFF_samlet_variabler |>
mutate(
udehold_rang    = as.factor(udehold_rang),
Er_helligdag    = as.factor(Er_helligdag),
ferieperiode    = as.factor(ferieperiode),
udehold         = as.factor(udehold)
)
# 2. Opdeling af data ------------------------------------------------------
set.seed(1)
n <- nrow(VFF_samlet_variabler)
train_index <- sample(1:n, size = round(0.7*n))
train_data <- VFF_samlet_variabler[train_index, ]
test_data  <- VFF_samlet_variabler[-train_index, ]
# 3. Håndter sjældne faktorniveauer ---------------------------------------
categorical_vars <- c("udehold", "udehold_navn", "stadion", "sponsor_stadion_navn",
"udehold_rang", "Er_helligdag", "ferieperiode")
# Lump sjældne niveauer i træningsdata
train_data <- train_data %>%
mutate(across(all_of(categorical_vars), ~ fct_lump_min(.x, min = 2)))
# Sørg for at testdata matcher træningens niveauer
for(v in categorical_vars){
test_data[[v]] <- factor(test_data[[v]], levels = levels(train_data[[v]]))
}
# Drop rækker i testdata, der har NA pga. faktorniveauer
test_data <- test_data %>% drop_na(all_of(categorical_vars))
# 4. Fit lineær regressionsmodel ------------------------------------------
# Fjernet redundante variable for at undgå aliasing:
# - Beholder kun udehold_rang (fjernet udehold og udehold_navn)
# - Beholder kun stadion (fjernet sponsor_stadion_navn)
# - Beholder kun ferieperiode (fjernet individuelle ferievariable)
stor_lm_model <- lm(
tilskuere ~ temp_dry + wind_speed + nedbør_seneste_7_timer +
ugedag + mål_hjemme + mål_ude + point_hjemmehold +
point_udehold + udehold_rang + sæson + runde + tidsperiode +
Er_helligdag + ferieperiode +
total_income + total_expense + net_balance +
antal_transfers + d10_tilskuere + d7_tilskuere + d3_tilskuere +
stadion + stadion_kapacitet,
data = train_data
)
summary(stor_lm_model)
# 5. Predict på testdata ---------------------------------------------------
tilskuere_hat <- predict(stor_lm_model, newdata = test_data)
# 6. Beregn MSE og RMSE, og R^2 på testdata---------------------------------
mse_stor_validation  <- mean((test_data$tilskuere - tilskuere_hat)^2)
rmse_stor_validation <- sqrt(mse_stor_validation)
ss_res <- sum((test_data$tilskuere - tilskuere_hat)^2)
ss_tot <- sum((test_data$tilskuere - mean(test_data$tilskuere))^2)
r2_test <- 1 - ss_res/ss_tot
mse_stor_validation
rmse_stor_validation
r2_test
# 7. Beregn VIF ------------------------------------------------------------
vif(stor_lm_model)
# Load nødvendige pakker
pacman::p_load("tidyverse", "forcats", "car")
# 1. Load data -------------------------------------------------------------
VFF_samlet_variabler <- readRDS("VFFdata/VFF_samlet_variabler.rds")
# Konverter relevante variabler til faktorer
VFF_samlet_variabler <- VFF_samlet_variabler |>
mutate(
udehold_rang    = as.factor(udehold_rang),
Er_helligdag    = as.factor(Er_helligdag),
i_sommerferie   = as.factor(i_sommerferie),
i_efterårsferie = as.factor(i_efterårsferie),
i_vinterferie   = as.factor(i_vinterferie),
ferieperiode    = as.factor(ferieperiode),
udehold         = as.factor(udehold)
)
# 2. Opdeling af data ------------------------------------------------------
set.seed(1)
n <- nrow(VFF_samlet_variabler)
train_index <- sample(1:n, size = round(0.7*n))
train_data <- VFF_samlet_variabler[train_index, ]
test_data  <- VFF_samlet_variabler[-train_index, ]
# 3. Håndter sjældne faktorniveauer ---------------------------------------
categorical_vars <- c("udehold","udehold_navn","stadion","sponsor_stadion_navn",
"udehold_rang","Er_helligdag","i_sommerferie","i_efterårsferie",
"i_vinterferie","ferieperiode")
# Lump sjældne niveauer i træningsdata
train_data <- train_data %>%
mutate(across(all_of(categorical_vars), ~ fct_lump_min(.x, min = 2)))
# Sørg for at testdata matcher træningens niveauer
for(v in categorical_vars){
test_data[[v]] <- factor(test_data[[v]], levels = levels(train_data[[v]]))
}
# Drop rækker i testdata, der har NA pga. faktorniveauer
test_data <- test_data %>% drop_na(all_of(categorical_vars))
# 4. Fit lineær regressionsmodel ------------------------------------------
stor_lm_model <- lm(
tilskuere ~ temp_dry + wind_speed + nedbør_seneste_7_timer +
ugedag + udehold + mål_hjemme + mål_ude + point_hjemmehold +
point_udehold + udehold_rang + sæson + runde + tidsperiode +
Er_helligdag + i_sommerferie + i_efterårsferie + i_vinterferie +
ferieperiode + total_income + total_expense + net_balance +
antal_transfers + d10_tilskuere + d7_tilskuere + d3_tilskuere +
udehold_navn + stadion + sponsor_stadion_navn + stadion_kapacitet,
data = train_data
)
summary(stor_lm_model)
# 5. Predict på testdata ---------------------------------------------------
tilskuere_hat <- predict(stor_lm_model, newdata = test_data)
# 6. Beregn MSE og RMSE, og R^2 på testdata---------------------------------
mse_stor_validation  <- mean((test_data$tilskuere - tilskuere_hat)^2)
rmse_stor_validation <- sqrt(mse_stor_validation)
ss_res <- sum((test_data$tilskuere - tilskuere_hat)^2)
ss_tot <- sum((test_data$tilskuere - mean(test_data$tilskuere))^2)
r2_test <- 1 - ss_res/ss_tot
mse_stor_validation
rmse_stor_validation
r2_test
vif(stor_lm_model)
# Load nødvendige pakker
pacman::p_load("tidyverse", "forcats", "car", "leaps")
# 1. Load data -------------------------------------------------------------
VFF_samlet_variabler <- readRDS("VFFdata/VFF_samlet_variabler.rds")
# Konverter relevante variabler til faktorer
VFF_samlet_variabler <- VFF_samlet_variabler |>
mutate(
udehold_rang    = as.factor(udehold_rang),
Er_helligdag    = as.factor(Er_helligdag),
i_sommerferie   = as.factor(i_sommerferie),
i_efterårsferie = as.factor(i_efterårsferie),
i_vinterferie   = as.factor(i_vinterferie),
ferieperiode    = as.factor(ferieperiode),
udehold         = as.factor(udehold)
)
# 2. Opdeling af data ------------------------------------------------------
set.seed(1)
n <- nrow(VFF_samlet_variabler)
train_index <- sample(1:n, size = round(0.7*n))
train_data <- VFF_samlet_variabler[train_index, ]
test_data  <- VFF_samlet_variabler[-train_index, ]
# 3. Håndter sjældne faktorniveauer ---------------------------------------
categorical_vars <- c("udehold","udehold_navn","stadion","sponsor_stadion_navn",
"udehold_rang","Er_helligdag","i_sommerferie","i_efterårsferie",
"i_vinterferie","ferieperiode")
train_data <- train_data %>%
mutate(across(all_of(categorical_vars), ~ fct_lump_min(.x, min = 2)))
for(v in categorical_vars){
test_data[[v]] <- factor(test_data[[v]], levels = levels(train_data[[v]]))
}
test_data <- test_data %>% drop_na(all_of(categorical_vars))
# 4. Fit STOR lineær regressionsmodel -------------------------------------
stor_lm_model <- lm(
tilskuere ~ temp_dry + wind_speed + nedbør_seneste_7_timer +
ugedag + udehold + mål_hjemme + mål_ude + point_hjemmehold +
point_udehold + udehold_rang + sæson + runde + tidsperiode +
Er_helligdag + i_sommerferie + i_efterårsferie + i_vinterferie +
ferieperiode + total_income + total_expense + net_balance +
antal_transfers + d10_tilskuere + d7_tilskuere + d3_tilskuere +
udehold_navn + stadion + sponsor_stadion_navn + stadion_kapacitet,
data = train_data
)
summary(stor_lm_model)
# -------- NYT: Tjek multikollinearitet i stor model ----------------------
vif(stor_lm_model)
# 5. Best subset (kun numeriske variabler) --------------------------------
num_vars <- train_data %>%
select(
tilskuere,
temp_dry, wind_speed, nedbør_seneste_7_timer,
mål_hjemme, mål_ude,
point_hjemmehold, point_udehold,
runde,
total_income, total_expense, net_balance,
antal_transfers,
d10_tilskuere, d7_tilskuere, d3_tilskuere,
stadion_kapacitet
)
best_subset <- regsubsets(
tilskuere ~ .,
data = num_vars,
nvmax = ncol(num_vars) - 1
)
best_sum <- summary(best_subset)
# Vælg model med højest justeret R^2
best_size <- which.max(best_sum$adjr2)
best_sum$which[best_size, ]
# 6. Fit REDUCERET model --------------------------------------------------
reduceret_model <- lm(
tilskuere ~ d10_tilskuere + d7_tilskuere + runde +
stadion_kapacitet + mål_hjemme + mål_ude,
data = train_data
)
summary(reduceret_model)
# -------- NYT: Tjek multikollinearitet i reduceret model -----------------
vif(reduceret_model)
# 7. Predict og evaluer reduceret model ----------------------------------
pred_test_reduceret <- predict(reduceret_model, newdata = test_data)
rmse_reduceret <- sqrt(mean((test_data$tilskuere - pred_test_reduceret)^2))
rmse_reduceret
# -------- NYT: Tjek multikollinearitet i reduceret model -----------------
vif(reduceret_model)
# -------- NYT: Tjek multikollinearitet i stor model ----------------------
vif(stor_lm_model)
# 5. Best subset (kun numeriske variabler) --------------------------------
num_vars <- train_data %>%
select(
tilskuere,
temp_dry, wind_speed, nedbør_seneste_7_timer,
mål_hjemme, mål_ude,
point_hjemmehold, point_udehold,
runde,
total_income, total_expense, net_balance,
antal_transfers,
d10_tilskuere, d7_tilskuere, d3_tilskuere,
stadion_kapacitet
)
best_subset <- regsubsets(
tilskuere ~ .,
data = num_vars,
nvmax = ncol(num_vars) - 1
)
best_sum <- summary(best_subset)
# Vælg model med højest justeret R^2
best_size <- which.max(best_sum$adjr2)
best_sum$which[best_size, ]
# 6. Fit REDUCERET model --------------------------------------------------
reduceret_model <- lm(
tilskuere ~ d10_tilskuere + d7_tilskuere + runde +
stadion_kapacitet + mål_hjemme + mål_ude,
data = train_data
)
summary(reduceret_model)
# -------- NYT: Tjek multikollinearitet i reduceret model -----------------
vif(reduceret_model)
# 7. Predict og evaluer reduceret model ----------------------------------
pred_test_reduceret <- predict(reduceret_model, newdata = test_data)
rmse_reduceret <- sqrt(mean((test_data$tilskuere - pred_test_reduceret)^2))
rmse_reduceret
# -------- NYT: Tjek multikollinearitet i reduceret model -----------------
vif(reduceret_model)
# Load nødvendige pakker
pacman::p_load("tidyverse", "forcats", "car", "leaps")
# 1. Load data -------------------------------------------------------------
VFF_samlet_variabler <- readRDS("VFFdata/VFF_samlet_variabler.rds")
# Konverter relevante variabler til faktorer
VFF_samlet_variabler <- VFF_samlet_variabler |>
mutate(
udehold_rang    = as.factor(udehold_rang),
Er_helligdag    = as.factor(Er_helligdag),
i_sommerferie   = as.factor(i_sommerferie),
i_efterårsferie = as.factor(i_efterårsferie),
i_vinterferie   = as.factor(i_vinterferie),
ferieperiode    = as.factor(ferieperiode),
udehold         = as.factor(udehold)
)
# 2. Opdeling af data ------------------------------------------------------
set.seed(1)
n <- nrow(VFF_samlet_variabler)
train_index <- sample(1:n, size = round(0.7*n))
train_data <- VFF_samlet_variabler[train_index, ]
test_data  <- VFF_samlet_variabler[-train_index, ]
# 3. Håndter sjældne faktorniveauer ---------------------------------------
categorical_vars <- c("udehold","udehold_navn","stadion","sponsor_stadion_navn",
"udehold_rang","Er_helligdag","i_sommerferie","i_efterårsferie",
"i_vinterferie","ferieperiode")
train_data <- train_data %>%
mutate(across(all_of(categorical_vars), ~ fct_lump_min(.x, min = 2)))
for(v in categorical_vars){
test_data[[v]] <- factor(test_data[[v]], levels = levels(train_data[[v]]))
}
test_data <- test_data %>% drop_na(all_of(categorical_vars))
# 4. Fit STOR lineær regressionsmodel -------------------------------------
stor_lm_model <- lm(
tilskuere ~ temp_dry + wind_speed + nedbør_seneste_7_timer +
ugedag + udehold + mål_hjemme + mål_ude + point_hjemmehold +
point_udehold + udehold_rang + sæson + runde + tidsperiode +
Er_helligdag + i_sommerferie + i_efterårsferie + i_vinterferie +
ferieperiode + total_income + total_expense + net_balance +
antal_transfers + d10_tilskuere + d7_tilskuere + d3_tilskuere +
udehold_navn + stadion + sponsor_stadion_navn + stadion_kapacitet,
data = train_data
)
summary(stor_lm_model)
# -------- NYT: Tjek multikollinearitet i stor model ----------------------
vif(stor_lm_model)
# 5. Best subset (kun numeriske variabler) --------------------------------
num_vars <- train_data %>%
select(
tilskuere,
temp_dry, wind_speed, nedbør_seneste_7_timer,
mål_hjemme, mål_ude,
point_hjemmehold, point_udehold,
runde,
total_income, total_expense, net_balance,
antal_transfers,
d10_tilskuere, d7_tilskuere, d3_tilskuere,
stadion_kapacitet
)
best_subset <- regsubsets(
tilskuere ~ .,
data = num_vars,
nvmax = ncol(num_vars) - 1
)
best_sum <- summary(best_subset)
# Vælg model med højest justeret R^2
best_size <- which.max(best_sum$adjr2)
best_sum$which[best_size, ]
# 6. Fit REDUCERET model --------------------------------------------------
reduceret_model <- lm(
tilskuere ~ d10_tilskuere + d7_tilskuere + runde +
stadion_kapacitet + mål_hjemme + mål_ude,
data = train_data
)
summary(reduceret_model)
# -------- NYT: Tjek multikollinearitet i reduceret model -----------------
vif(reduceret_model)
# 7. Predict og evaluer reduceret model ----------------------------------
pred_test_reduceret <- predict(reduceret_model, newdata = test_data)
rmse_reduceret <- sqrt(mean((test_data$tilskuere - pred_test_reduceret)^2))
rmse_reduceret
# Load nødvendige pakker
pacman::p_load("tidyverse", "forcats", "car", "leaps")
# 1. Load data -------------------------------------------------------------
VFF_samlet_variabler <- readRDS("VFFdata/VFF_samlet_variabler.rds")
# Konverter relevante variabler til faktorer
VFF_samlet_variabler <- VFF_samlet_variabler |>
mutate(
udehold_rang    = as.factor(udehold_rang),
Er_helligdag    = as.factor(Er_helligdag),
i_sommerferie   = as.factor(i_sommerferie),
i_efterårsferie = as.factor(i_efterårsferie),
i_vinterferie   = as.factor(i_vinterferie),
ferieperiode    = as.factor(ferieperiode),
udehold         = as.factor(udehold)
)
# 2. Opdeling af data ------------------------------------------------------
set.seed(1)
n <- nrow(VFF_samlet_variabler)
train_index <- sample(1:n, size = round(0.8*n))
train_data <- VFF_samlet_variabler[train_index, ]
test_data  <- VFF_samlet_variabler[-train_index, ]
# 3. Håndter sjældne faktorniveauer ---------------------------------------
categorical_vars <- c("udehold","udehold_navn","stadion","sponsor_stadion_navn",
"udehold_rang","Er_helligdag","i_sommerferie","i_efterårsferie",
"i_vinterferie","ferieperiode")
train_data <- train_data %>%
mutate(across(all_of(categorical_vars), ~ fct_lump_min(.x, min = 2)))
for(v in categorical_vars){
test_data[[v]] <- factor(test_data[[v]], levels = levels(train_data[[v]]))
}
test_data <- test_data %>% drop_na(all_of(categorical_vars))
# 4. Fit STOR lineær regressionsmodel -------------------------------------
stor_lm_model <- lm(
tilskuere ~ temp_dry + wind_speed + nedbør_seneste_7_timer +
ugedag + udehold + mål_hjemme + mål_ude + point_hjemmehold +
point_udehold + udehold_rang + sæson + runde + tidsperiode +
Er_helligdag + i_sommerferie + i_efterårsferie + i_vinterferie +
ferieperiode + total_income + total_expense + net_balance +
antal_transfers + d10_tilskuere + d7_tilskuere + d3_tilskuere +
udehold_navn + stadion + sponsor_stadion_navn + stadion_kapacitet,
data = train_data
)
summary(stor_lm_model)
# -------- NYT: Tjek multikollinearitet i stor model ----------------------
vif(stor_lm_model)
# 5. Best subset (kun numeriske variabler) --------------------------------
num_vars <- train_data %>%
select(
tilskuere,
temp_dry, wind_speed, nedbør_seneste_7_timer,
mål_hjemme, mål_ude,
point_hjemmehold, point_udehold,
runde,
total_income, total_expense, net_balance,
antal_transfers,
d10_tilskuere, d7_tilskuere, d3_tilskuere,
stadion_kapacitet
)
best_subset <- regsubsets(
tilskuere ~ .,
data = num_vars,
nvmax = ncol(num_vars) - 1
)
best_sum <- summary(best_subset)
# Vælg model med højest justeret R^2
best_size <- which.max(best_sum$adjr2)
best_sum$which[best_size, ]
# 6. Fit REDUCERET model --------------------------------------------------
reduceret_model <- lm(
tilskuere ~ d10_tilskuere + d7_tilskuere + runde +
stadion_kapacitet + mål_hjemme + mål_ude,
data = train_data
)
summary(reduceret_model)
# -------- NYT: Tjek multikollinearitet i reduceret model -----------------
vif(reduceret_model)
# 7. Predict og evaluer reduceret model ----------------------------------
pred_test_reduceret <- predict(reduceret_model, newdata = test_data)
rmse_reduceret <- sqrt(mean((test_data$tilskuere - pred_test_reduceret)^2))
rmse_reduceret
# Konverter relevante variabler til faktorer
VFF_samlet_variabler <- VFF_samlet_variabler |>
mutate(
udehold_rang    = as.factor(udehold_rang),
Er_helligdag    = as.factor(Er_helligdag),
i_sommerferie   = as.factor(i_sommerferie),
i_efterårsferie = as.factor(i_efterårsferie),
i_vinterferie   = as.factor(i_vinterferie),
ferieperiode    = as.factor(ferieperiode),
udehold         = as.factor(udehold)
)
# 2. Opdeling af data ------------------------------------------------------
set.seed(1)
n <- nrow(VFF_samlet_variabler)
train_index <- sample(1:n, size = round(0.7*n))
train_data <- VFF_samlet_variabler[train_index, ]
test_data  <- VFF_samlet_variabler[-train_index, ]
# 3. Håndter sjældne faktorniveauer ---------------------------------------
categorical_vars <- c("udehold","udehold_navn","stadion","sponsor_stadion_navn",
"udehold_rang","Er_helligdag","i_sommerferie","i_efterårsferie",
"i_vinterferie","ferieperiode")
train_data <- train_data %>%
mutate(across(all_of(categorical_vars), ~ fct_lump_min(.x, min = 2)))
for(v in categorical_vars){
test_data[[v]] <- factor(test_data[[v]], levels = levels(train_data[[v]]))
}
test_data <- test_data %>% drop_na(all_of(categorical_vars))
# 4. Fit STOR lineær regressionsmodel -------------------------------------
stor_lm_model <- lm(
tilskuere ~ temp_dry + wind_speed + nedbør_seneste_7_timer +
ugedag + udehold + mål_hjemme + mål_ude + point_hjemmehold +
point_udehold + udehold_rang + sæson + runde + tidsperiode +
Er_helligdag + i_sommerferie + i_efterårsferie + i_vinterferie +
ferieperiode + total_income + total_expense + net_balance +
antal_transfers + d10_tilskuere + d7_tilskuere + d3_tilskuere +
udehold_navn + stadion + sponsor_stadion_navn + stadion_kapacitet,
data = train_data
)
summary(stor_lm_model)
# -------- NYT: Tjek multikollinearitet i stor model ----------------------
vif(stor_lm_model)
# 5. Best subset (kun numeriske variabler) --------------------------------
num_vars <- train_data %>%
select(
tilskuere,
temp_dry, wind_speed, nedbør_seneste_7_timer,
mål_hjemme, mål_ude,
point_hjemmehold, point_udehold,
runde,
total_income, total_expense, net_balance,
antal_transfers,
d10_tilskuere, d7_tilskuere, d3_tilskuere,
stadion_kapacitet
)
best_subset <- regsubsets(
tilskuere ~ .,
data = num_vars,
nvmax = ncol(num_vars) - 1
)
best_sum <- summary(best_subset)
# Vælg model med højest justeret R^2
best_size <- which.max(best_sum$adjr2)
best_sum$which[best_size, ]
# 6. Fit REDUCERET model --------------------------------------------------
reduceret_model <- lm(
tilskuere ~ d10_tilskuere + d7_tilskuere + runde +
stadion_kapacitet + mål_hjemme + mål_ude,
data = train_data
)
summary(reduceret_model)
# -------- NYT: Tjek multikollinearitet i reduceret model -----------------
vif(reduceret_model)
# 7. Predict og evaluer reduceret model ----------------------------------
pred_test_reduceret <- predict(reduceret_model, newdata = test_data)
rmse_reduceret <- sqrt(mean((test_data$tilskuere - pred_test_reduceret)^2))
rmse_reduceret
